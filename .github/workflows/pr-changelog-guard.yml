name: PR Changelog Guard

on:
  pull_request:
    types: [opened, edited, synchronize]

permissions:
  contents: read
  pull-requests: write
  issues: write

jobs:
  guard:
    name: Check PR body for Changelog
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Validate Changelog presence and labels
        uses: actions/github-script@v6
        with:
          script: |
            (async () => {
              const module = await import(process.env.GITHUB_WORKSPACE + '/.github/js_repo_tools/pr-changelog-guard.mjs');
              await module.run(github, context, core, { CHANGELOG_GUIDE_URL: process.env.CHANGELOG_GUIDE_URL, BYPASS_LABELS: process.env.BYPASS_LABELS, AUTHOR_ALLOWLIST: process.env.AUTHOR_ALLOWLIST });
            })();
        env:
          CHANGELOG_GUIDE_URL: https://github.com/${{ github.repository }}/blob/main/docs/repo/CHANGELOG_GUIDE.md
